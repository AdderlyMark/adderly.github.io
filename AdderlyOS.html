<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Симулятор ОС</title>
    <link rel="stylesheet" href="aos.css">
</head>
<body>
    <!-- Рабочий стол -->
    <div id="desktop">
        <!-- Панель задач -->
        <div id="taskbar">
            <div id="taskbar-content">
                <div id="taskbar-buttons">
                    <button onclick="openWindow('startMenu')">Пуск</button>
                    <button onclick="openWindow('notepad')">Блокнот</button>
                    <button onclick="openWindow('calculator')">Калькулятор</button>
                    <button onclick="openWindow('browser')">Браузер</button>
                </div>
                <div id="date-time">
                    <span id="day"></span><br>
                    <span id="time"></span>
                </div>
            </div>
        </div>



        <!-- Окно калькулятора -->
        <div id="calculator" class="window">
            <div class="window-header">
                <span>MakuCalc</span>
                <div>
                    <button onclick="minimizeWindow('calculator')">_</button>
                    <button onclick="closeWindow('calculator')">X</button>
                </div>
            </div>
            <div class="window-content">
                <input type="text" id="calcDisplay" disabled>
<div id="calcButtons">
    <!-- Первый ряд кнопок -->
    <button onclick="calcInput('%')">%</button>
    <button onclick="calcClear()">C</button>
    <button onclick="calcBackspace()">←</button>
    <button onclick="calcInput('/')" class="operation">/</button>
    <!-- Второй ряд кнопок -->
    <button onclick="calcInput('7')">7</button>
    <button onclick="calcInput('8')">8</button>
    <button onclick="calcInput('9')">9</button>
    <button onclick="calcInput('*')" class="operation">×</button>
    <!-- Третий ряд кнопок -->
    <button onclick="calcInput('4')">4</button>
    <button onclick="calcInput('5')">5</button>
    <button onclick="calcInput('6')">6</button>
    <button onclick="calcInput('-')" class="operation">-</button>
    <!-- Четвертый ряд кнопок -->
    <button onclick="calcInput('1')">1</button>
    <button onclick="calcInput('2')">2</button>
    <button onclick="calcInput('3')">3</button>
    <button onclick="calcInput('+')" class="operation">+</button>
    <!-- Пятый ряд кнопок -->
    <button onclick="calcInput('0')" style="grid-column: span 1">0</button>
    <button onclick="calcInput('.')">.</button>
    <button onclick="calcEquals()" class="equal">=</button>
</div>


            </div>
        </div>

<!-- Окно блокнота -->
<div id="notepad" class="window resizable">
    <div class="window-header">
        <span>MakuTyper Lite</span>
        <button class="minimize-button" onclick="minimizeWindow('notepad')">_</button>
        <button onclick="closeWindow('notepad')">X</button>
    </div>
    <div class="window-content">
        <textarea id="notepadContent" placeholder=""></textarea>
        <div class="button-container">
            <button id="saveButton" onclick="saveFile()">Сохранить файл как...</button>
            <button id="openButton" onclick="document.getElementById('fileInput').click()">Открыть файл</button>
        </div>
        <input type="file" id="fileInput" style="display: none;" onchange="loadFile(event)">
    </div>
</div>





<!-- Окно браузера -->
<div id="browser" class="window">
        <div class="window-header">
            <span>MakuBrowser</span>
        <button class="minimize-button" onclick="minimizeWindow('browser')">_</button>
            <button onclick="closeWindow('browser')">X</button>
        </div>
        <div class="window-content">
            <input type="text" id="browser-url" placeholder="URL">
            <button onclick="navigateToUrl()">Перейти</button>
            <iframe id="browser-frame" style="width: 100%; height: 94%;"></iframe>
            <!-- Элемент для изменения размера -->
        </div>
    </div>



        <!-- Окно Пуска -->
        <div id="startMenu" class="window">
            <div class="window-header">
                <span>Пуск</span>
                <button onclick="closeWindow('startMenu')">X</button>
            </div>
            <div class="window-content">
                <p>Меню Пуск.</p>
            </div>
        </div>
    </div>

    <script>
    // Открытие/скрытие окна
    function openWindow(windowId) {
        const windowElement = document.getElementById(windowId);
        const isVisible = windowElement.style.display === 'flex';
        
        if (isVisible) {
            windowElement.style.display = 'none';
        } else {
            // Открываем выбранное окно
            windowElement.style.display = 'flex';
            // Перемещаем окно наверх
            bringToFront(windowElement);
        }
    }

    // Закрытие окна
    function closeWindow(windowId) {
        document.getElementById(windowId).style.display = 'none';
    }

    // Свертывание окна
    function minimizeWindow(windowId) {
        document.getElementById(windowId).style.display = 'none';
    }

    // Перемещение окон
    let offsetX = 0, offsetY = 0, currentWindow = null;

    document.querySelectorAll('.window-header').forEach(header => {
        header.onmousedown = function(e) {
            currentWindow = header.parentElement;
            offsetX = e.clientX - currentWindow.getBoundingClientRect().left;
            offsetY = e.clientY - currentWindow.getBoundingClientRect().top;
            document.onmousemove = function(e) {
                if (currentWindow) {
                    currentWindow.style.left = `${e.clientX - offsetX}px`;
                    currentWindow.style.top = `${e.clientY - offsetY}px`;
                    // Сохранение позиции окна
                    saveWindowPosition(currentWindow.id);
                }
            };
            document.onmouseup = function() {
                document.onmousemove = document.onmouseup = null;
                currentWindow = null;
            };
        };
    });

    // Перемещение окна на передний план
    function bringToFront(windowElement) {
        windowElement.style.zIndex = 1000;
    }

function navigateToUrl() {
    const url = document.getElementById('browser-url').value;
    const iframe = document.getElementById('browser-frame');
    
    // Добавление префикса http:// если URL не начинается с http:// или https://
    if (!/^https?:\/\//i.test(url)) {
        iframe.src = `http://${url}`;
    } else {
        iframe.src = url;
    }
}

function restoreWindowPosition(windowId) {
    const position = JSON.parse(localStorage.getItem(`${windowId}-position`));
    const windowElement = document.getElementById(windowId);

    if (position) {
        windowElement.style.left = position.left || '400px';
        windowElement.style.top = position.top || '400px';
    } else {
        // Устанавливаем начальное положение, если нет сохраненных данных
        windowElement.style.left = '400px';
        windowElement.style.top = '400px';
    }
}

// Сохранение позиции окна в localStorage
function saveWindowPosition(windowId) {
    const windowElement = document.getElementById(windowId);
    // Сохраняем только если позиция изменилась
    if (windowElement.style.left && windowElement.style.top) {
        localStorage.setItem(`${windowId}-position`, JSON.stringify({
            left: windowElement.style.left,
            top: windowElement.style.top
        }));
    }
}

    // Инициализация окон
document.addEventListener('DOMContentLoaded', () => {
    // Восстановление позиции всех окон
    ['calculator', 'notepad', 'browser', 'startMenu'].forEach(windowId => {
        restoreWindowPosition(windowId);
    });
        // Инициализация времени
        updateDateTime();
        setInterval(updateDateTime, 1000); // Обновление времени каждую секунду
        
        // Обработка кнопки "Перейти" в микро-браузере
        document.getElementById('go-button').addEventListener('click', function() {
            const url = document.getElementById('url-input').value;
            const iframe = document.getElementById('browser-frame');
            iframe.src = url.startsWith('http') ? url : `http://${url}`;
        });
    });

    // Логика для калькулятора
    let calcValue = '';

    function calcInput(value) {
        calcValue += value;
        document.getElementById('calcDisplay').value = calcValue;
    }

    function calcClear() {
        calcValue = '';
        document.getElementById('calcDisplay').value = '';
    }

    function calcBackspace() {
        calcValue = calcValue.slice(0, -1);
        document.getElementById('calcDisplay').value = calcValue;
    }

    function calcEquals() {
        try {
            calcValue = eval(calcValue);
            document.getElementById('calcDisplay').value = calcValue;
        } catch {
            document.getElementById('calcDisplay').value = 'Ошибка';
        }
    }

    // Загрузка файла в блокнот
    function loadFile(event) {
        const file = event.target.files[0];
        if (file && file.type === 'text/plain') {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('notepadContent').value = e.target.result;
            };
            reader.readAsText(file);
        } else {
            alert('Пожалуйста, выберите текстовый файл.');
        }
    }

    // Сохранение файла из блокнота
    function saveFile() {
        const content = document.getElementById('notepadContent').value;
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'MakuTyper.txt'; // Имя файла по умолчанию
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
            URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }, 0);
    }

    // Обновление времени и даты
    function updateDateTime() {
        const now = new Date();
        const days = ["Воскресенье", "Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота"];
        const day = days[now.getDay()];
        const time = now.toTimeString().split(' ')[0].slice(0, 5);
        document.getElementById('date-time').innerHTML = `${day}<br>${time}`;
    }

// Запуск функции изменения размера
makeResizable(document.getElementById('browser'));

async function loadPage(url) {
    try {
        const response = await fetch(url, { mode: 'cors' });
        if (!response.ok) throw new Error('Network response was not ok');
        const text = await response.text();
        const iframe = document.getElementById('browser-frame');
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write(text);
        iframeDoc.close();
    } catch (error) {
        console.error('Failed to load page:', error);
    }
}

document.querySelector('.navigate-button').addEventListener('click', function() {
    // Код для перехода по URL или выполнения действия
    let url = document.querySelector('.url-input').value;
    if (url) {
        window.open(url, '_blank'); // Открывает URL в новой вкладке
    }
});

function navigateToUrl() {
    const url = document.getElementById('browser-url').value;
    loadPage(url);
}


</script>

</body>
</html>
